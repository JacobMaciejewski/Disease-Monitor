Προγραμματισμός Συστήματος - 3η Εργασία, Εαρινό Εξάμηνο 2020

Γιακούμπ Ματσιεγιέβσκι
Αριθμός Μητρώου: 1115201700080

ΣΥΜΒΆΣΕΙΣ:

Όλες οι συμβάσεις ακολουθούν πιστά τις απαντήσεις των βοηθών, όπως αυτές διατυπώθηκαν στην σελιδά επικοινωνίας piazza. Σε περίπτωση, που κάποια είναι ασαφής, ο εξεταστής μπορεί να με ρωτήσει σχετικά με το οτιδήποτε.

1)Η σειρά των προγραμμάτων έχει ως εξής:

>./whoServer -q _ -s _ -w _ -b _

>./master -w _ -b _ -s _ -p _ -i _

>./whoClient -q _ -w _ -sp _ -sip _

2)Οι εργάτες δεν πεθαίνουν κατά την διάρκεια εκτέλεσης του προγραμμάτος. Ο κώδικας εξασφαλίζει ότι οι εργάτες δεν θα πεθάνουν κατά την απάντηση ερωτήματων που τους τίθενται απ' τον server. 

3)Το μέγεθος του buffer που χρησιμοποιείται για την αποστολή/λήψη μηνυμάτων από τα sockets τίθεται μέσω ενός macro εντός του κώδικα. Ο αριθμός αυτός είναι ίσος με 4096 bytes, εξασφαλίζοντας την αποστολή όλοκληρου μηνύματος με μια απόπειρα και αυξάνοντας την ταχύτητα του προγραμμάτος. Για τον pipe/circular buffer χρησιμοποιούνται τα δοσμένα απ' τον χρήστη μεγέθη.

4)Μετά την λήψη απάντησης για ένα query, το server thread καθώς και ο worker κλείνουν την επικοινωνία, η όποια επαναεγκαθιδρύεται βάση του αποθηκευμένου port και ip του εκάστοτε worker για κάθε ένα καινούργιο query.

5)Το macros BACKLOG εκφράζει τον μέγιστο αριθμό αιτημάτων σύνδεσης που μπορούν να αναμένουν για ένα listening socket και έχει τεθεί ίσο με 500, προκείμενου το πρόγραμμα να εκτελείται επιτυχώς για μεγάλο αριθμό από server threads και για αριθμό queries που υπερβαίνει το 1 εκατομμύριο.

6)Όλα τα προγράμματα τερματίζουν με CTRL + C, δηλαδή SIGINT. Έχει δηλωθεί ρητά ότι η εργασία δεν θα εξεταστεί βάση του signal handling, επομένως συμβουλεύεται τα προγράμματα να τερματίζονται αφότου έχουν εκτελεστεί.

7)Λόγω της προηγούμενης σύμβασης, το πρόγραμμα ενδέχεται να παρουσιάζει μικρά memory leaks που οφείλονται σε memory allocations πριν την εκτέλεση των queries. Η δυναμικά δεσμευόμενη μνήμη, κατά την εκτέλεση του πυρήνα του προγράμματος αποδεσμεύεται επιτυχώς, με αποτέλεσμα να μην παρουσιάζονται σημαντικές αυξήσεις στο μέγεθος της δεσμευμένης RAM ακόμα και για εκτελέσεις που υπερβαίνουν το 1 εκατομμύριο queries. Η μόνη αδέσμευτη μνήμη είναι αυτή των δύο file descriptors που ανήκουν στα δύο listening sockets του server, ο πίνακας IPs και Ports των workers και ένας κενός circular buffer.

8)Η σειρά τερματισμού των προγραμμάτων έχει ως εξής:
>Ο client τερματίζει μόνος του αφότου ληφθούν όλες οι απαντήσεις για τα queries του αρχείου
>Κλείνουμε τον master με CTRL + C
>Κλείνουμε τον server με CTRL + C


Σχεδιαστικές επιλογές:

1)Το server λαμβάνει δύο είδη αιτημάτων, client και worker request. Το file descriptor που επιστρέφει η accept στο client/worker listening socket απ' το όποιο λήφθηκε ένα αίτημα, μετατρέπεται σε ένα duplet προσδιοριστικού, τύπου αιτήματος, το όποιο αποθηκεύεται στον circular buffer. Στην συνέχεια, κάποιο διαθέσιμο thread λαμβάνει το duplet και ανάλογα με το αν πρόκειται για client, worker request, στέλνει το query στους κατάλληλους workers ή αντίστοιχα λαμβάνει metadata, statistics απ'τον αιτούμενο worker.

2)Το master πρόγραμμα στέλνει στους εργάτες ένα αναγνωριστικό, διαφορετικό για τον καθένα τους και τον συνολικό τους αριθμό. Αυτή η πληροφορία σε συνδιασμό με το randomly generated worker port και την ip της συσκευής, στην όποια εκτελούνται οι workers, αποστέλονται σε ένα metadata μήνυμα στα server threads προς επεξεργασία.

3)Το metadata message ακολουθείται από μηνύματα στατιστικών που στέλνει ο εκάστοτε worker στον server και τα όποια τυπώνονται απ' το ίδιο thread που έλαβε το αρχικό meta data message.

4)Ένα client thread εκτυπώνει ένα ληφθέν query και την απάντηση τους αφότου η δεύτερη ληφθεί από τον server. Έτσι εξασφαλίζεται ότι οι δυάδες ερωτήματος και απάντησης θα εκτυπώνονται πάντα μαζί.

ΠΕΡΙΕΧΌΜΕΝΑ ΑΡΧΕΊΟΥ:
>Φάκελοι που περιέχουν τον κώδικα του master, server και client

>MakeFile που παρέχει και την δυνατότητα make clean

>Python script για την παραγωγή ερωτημάτων προς τον server. Δεν διαθέτω τα πνευματικά δικαιώματα για το συγκεκριμένο script, το όποιο είναι δημοσιευμένο στο piazza και χρησιμοποιήθηκε για δοκιμές πάνω στην εργασία. Πέρα του python script περιλαμβάνω τα αρχεία diseases.txt, countries.txt, commands.txt (περιέχει το σύνολο των ειδών ερωτημάτων που μας ζητούνται).

>ΤΟ ΑΡΧΕΊΟ ΠΕΡΙΈΧΕΙ ΑΡΧΕΊΟ ΟΝΌΜΑΤΙ DATABASE ΜΕ 3 ΧΙΛΙΆΔΕΣ ΕΓΓΡΑΦΈΣ ΕΤΏΝ 1821-2020 ΌΠΩΣ ΑΥΤΈΣ ΠΑΡΆΧΘΗΚΑΝ ΑΠ' ΤΟ ΖΗΤΟΎΜΕΝΟ SCRIPT ΤΗΣ ΠΡΟΗΓΟΎΜΕΝΗΣ ΕΡΓΑΣΊΑΣ

COMPILATION:

Απλά εκτελούμε την εντολή make

PYTHON SCRIPT:

Παράδειγμα παραγωγής αρχείου με 1000 εντολές για το έτος 1821:

python3 queries.py --queryFile queries.txt --numQueries 1000 --commandsFile commands.txt --countriesFile countries.txt --diseasesFile diseases.txt --startDate 01-01-1821 --endDate 30-12-1821


 







